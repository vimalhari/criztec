---
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';
import Image from '~/components/common/Image.astro';
import { Icon } from 'astro-icon/components';
import type { Widget } from '~/types';

interface ValueItem {
  title: string;
  description: string;
  icon: string;
  color?: 'primary' | 'blue' | 'green' | 'purple';
}

interface Props extends Widget {
  title?: string;
  subtitle?: string;
  tagline?: string;
  items?: ValueItem[];
  image?: {
    src: string;
    alt: string;
    width?: number;
    height?: number;
  };
}

const {
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline = await Astro.slots.render('tagline'),
  items = [],
  image,

  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
} = Astro.props;

const colorClasses = {
  primary: {
    bg: 'bg-primary/10 dark:bg-primary/20',
    icon: 'text-primary',
    border: 'border-primary/20',
    glow: 'group-hover:shadow-primary/20',
  },
  blue: {
    bg: 'bg-blue-500/10 dark:bg-blue-500/20',
    icon: 'text-blue-500',
    border: 'border-blue-500/20',
    glow: 'group-hover:shadow-blue-500/20',
  },
  green: {
    bg: 'bg-emerald-500/10 dark:bg-emerald-500/20',
    icon: 'text-emerald-500',
    border: 'border-emerald-500/20',
    glow: 'group-hover:shadow-emerald-500/20',
  },
  purple: {
    bg: 'bg-purple-500/10 dark:bg-purple-500/20',
    icon: 'text-purple-500',
    border: 'border-purple-500/20',
    glow: 'group-hover:shadow-purple-500/20',
  },
};

const defaultColors = ['primary', 'blue', 'green', 'purple'] as const;
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-7xl mx-auto ${classes?.container ?? ''}`} bg={bg}>
  <div class="grid lg:grid-cols-2 gap-10 lg:gap-16 items-center">
    <!-- Left Column: Image with floating elements -->
    <div
      class="relative order-2 lg:order-1 intersect-once motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade intersect-quarter"
    >
      <div class="relative">
        {
          image && (
            <div class="relative rounded-3xl overflow-hidden shadow-2xl">
              <Image
                class="w-full h-[400px] lg:h-[500px] object-cover"
                width={600}
                height={500}
                widths={[400, 600, 800]}
                sizes="(max-width: 1024px) 100vw, 50vw"
                {...image}
              />
              <div class="absolute inset-0 bg-gradient-to-tr from-primary/30 via-transparent to-transparent" />
            </div>
          )
        }

        <div
          class="absolute -bottom-6 -right-6 bg-white dark:bg-slate-800 rounded-2xl p-5 shadow-xl border border-gray-100 dark:border-slate-700 hidden md:block"
        >
          <div class="flex items-center gap-4">
            <div class="w-14 h-14 bg-primary/10 rounded-xl flex items-center justify-center">
              <Icon name="tabler:trophy" class="w-7 h-7 text-primary" />
            </div>
            <div>
              <div class="text-2xl font-bold text-gray-900 dark:text-white">95%</div>
              <div class="text-sm text-muted">Client Success Rate</div>
            </div>
          </div>
        </div>

        <div
          class="absolute -top-4 -left-4 bg-primary text-white rounded-full px-5 py-2 shadow-lg font-semibold text-sm hidden md:flex items-center gap-2"
        >
          <Icon name="tabler:star-filled" class="w-4 h-4" />
          Trusted Partner
        </div>
      </div>
    </div>

    <!-- Right Column: Content -->
    <div class="order-1 lg:order-2">
      <Headline
        title={title}
        subtitle={subtitle}
        tagline={tagline}
        classes={{
          container: 'text-left mb-8',
          title: 'text-4xl font-bold tracking-tight mb-4 font-heading',
          subtitle: 'text-lg text-muted dark:text-slate-400 max-w-lg',
        }}
      />

      <div class="space-y-5">
        {
          items.map((item, index) => {
            const color = item.color || defaultColors[index % defaultColors.length];
            const colors = colorClasses[color];
            return (
              <div
                class={`group relative p-5 rounded-2xl bg-white dark:bg-slate-800/50 border ${colors.border} shadow-sm hover:shadow-xl ${colors.glow} transition-all duration-300 intersect-once motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade intersect-quarter`}
                style={`animation-delay: ${index * 100}ms`}
              >
                <div class="flex gap-4">
                  <div
                    class={`shrink-0 w-14 h-14 ${colors.bg} rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform duration-300`}
                  >
                    <Icon name={item.icon} class={`w-7 h-7 ${colors.icon}`} />
                  </div>

                  <div class="flex-1">
                    <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-1 group-hover:text-primary transition-colors">
                      {item.title}
                    </h3>
                    <p class="text-sm text-muted dark:text-slate-400 leading-relaxed">{item.description}</p>
                  </div>

                  <div class="shrink-0 self-center opacity-0 group-hover:opacity-100 -translate-x-2 group-hover:translate-x-0 transition-all duration-300">
                    <Icon name="tabler:chevron-right" class="w-5 h-5 text-primary" />
                  </div>
                </div>

                <div
                  class={`absolute bottom-0 left-5 right-5 h-0.5 ${colors.bg} scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left rounded-full`}
                />
              </div>
            );
          })
        }
      </div>

      <div class="mt-8 flex flex-wrap items-center gap-4">
        <a
          href="/about"
          class="inline-flex items-center gap-2 bg-primary hover:bg-primary/90 text-white font-semibold px-6 py-3 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl hover:-translate-y-0.5"
        >
          Learn More About Us
          <Icon name="tabler:arrow-right" class="w-5 h-5" />
        </a>
        <a
          href="/contact"
          class="inline-flex items-center gap-2 text-gray-700 dark:text-slate-300 hover:text-primary font-semibold transition-colors"
        >
          <Icon name="tabler:message-circle" class="w-5 h-5" />
          Get in Touch
        </a>
      </div>
    </div>
  </div>
</WidgetWrapper>
