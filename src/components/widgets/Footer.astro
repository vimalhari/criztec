---
import { Icon } from 'astro-icon/components';
import { SITE } from 'criztec:config';
import { getHomePermalink } from '~/utils/permalinks';

interface Link {
  text?: string;
  href?: string;
  ariaLabel?: string;
  icon?: string;
}

interface Links {
  title?: string;
  links: Array<Link>;
}

export interface Props {
  links?: Array<Links>;
  secondaryLinks?: Array<Link>;
  socialLinks?: Array<Link>;
  footNote?: string;
  theme?: string;
  trustBadges?: Array<Link>;
  googleReview?: { href?: string; text?: string; subText?: string };
}

const {
  socialLinks = [],
  secondaryLinks = [],
  links = [],
  footNote = '',
  theme = 'light',
  trustBadges = [],
  googleReview,
} = Astro.props;
---

<footer
  class:list={[{ dark: theme === 'dark' }, 'relative not-prose overflow-hidden']}
  role="contentinfo"
  aria-label="Site footer"
>
  {/* Main footer background with gradient */}
  <div class="relative bg-gradient-to-b from-slate-900 to-slate-950 pt-10 pb-6">
    {/* Subtle gradient accent */}
    <div
      class="absolute top-0 left-1/2 -translate-x-1/2 w-1/2 h-px bg-gradient-to-r from-transparent via-primary/50 to-transparent"
    >
    </div>

    {/* Gradient orb for modern effect */}
    <div class="absolute top-0 left-1/4 w-64 h-64 bg-primary/5 rounded-full blur-3xl pointer-events-none"></div>

    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      {/* Main content grid - compact layout */}
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-12 gap-8 lg:gap-6">
        {/* Brand Column */}
        <div class="lg:col-span-3 space-y-4">
          {/* Logo */}
          <a class="inline-flex items-center group" href={getHomePermalink()}>
            <span
              class="text-xl font-bold bg-gradient-to-r from-primary via-amber-400 to-primary bg-[length:200%_auto] bg-clip-text text-transparent group-hover:animate-gradient-x transition-all duration-500"
            >
              {SITE?.name}
            </span>
          </a>

          {/* Tagline */}
          <p class="text-slate-400 text-xs leading-relaxed">
            Professional web development, digital marketing & IT solutions.
          </p>

          {/* Contact - inline compact */}
          <div class="flex flex-col gap-2 text-xs">
            <a
              href="mailto:info@criztec.com"
              class="inline-flex items-center gap-2 text-slate-400 hover:text-primary transition-colors"
            >
              <Icon name="tabler:mail" class="w-3.5 h-3.5 text-primary/70" />
              info@criztec.com
            </a>
            <a
              href="tel:+447404979307"
              class="inline-flex items-center gap-2 text-slate-400 hover:text-primary transition-colors"
            >
              <Icon name="tabler:phone" class="w-3.5 h-3.5 text-primary/70" />
              +44 7404 979307
            </a>
          </div>

          {/* Social Links - compact */}
          {
            socialLinks?.length ? (
              <div class="flex flex-wrap gap-2 pt-1">
                {socialLinks.map(({ ariaLabel, href, text, icon }) => (
                  <a
                    class="group w-8 h-8 rounded-lg bg-white/5 border border-white/10 flex items-center justify-center hover:border-primary/50 hover:bg-primary/10 transition-all duration-200"
                    aria-label={ariaLabel}
                    href={href}
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    <div class="text-slate-500 group-hover:text-primary transition-colors">
                      {icon && <Icon name={icon} class="w-4 h-4" />}
                      {!icon && text && <Fragment set:html={text} />}
                    </div>
                  </a>
                ))}
              </div>
            ) : null
          }

          {/* Google Review Badge */}
          {
            googleReview && (
              <div class="pt-4">
                <a
                  href={googleReview.href}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 border border-white/10 hover:border-primary/50 transition-all group"
                >
                  <div class="flex items-center justify-center w-8 h-8 rounded-full bg-white text-white">
                    <Icon name="logos:google-icon" class="w-5 h-5" />
                  </div>
                  <div class="flex flex-col">
                    <div class="flex items-center gap-1">
                      <span class="text-white font-medium text-sm">{googleReview.text}</span>
                      <div class="flex text-amber-400">
                        <Icon name="tabler:star-filled" class="w-3 h-3" />
                        <Icon name="tabler:star-filled" class="w-3 h-3" />
                        <Icon name="tabler:star-filled" class="w-3 h-3" />
                        <Icon name="tabler:star-filled" class="w-3 h-3" />
                        <Icon name="tabler:star-filled" class="w-3 h-3" />
                      </div>
                    </div>
                    {googleReview.subText && <span class="text-slate-400 text-[10px]">{googleReview.subText}</span>}
                  </div>
                </a>
              </div>
            )
          }
        </div>

        {/* Navigation Links - compact grid */}
        <div class="lg:col-span-6">
          <div class="grid grid-cols-2 md:grid-cols-3 gap-6">
            {
              links.map(({ title, links: linkItems }) => (
                <nav aria-labelledby={`footer-${title?.toLowerCase().replace(/\s+/g, '-')}-heading`}>
                  <h3
                    id={`footer-${title?.toLowerCase().replace(/\s+/g, '-')}-heading`}
                    class="text-white font-medium text-xs uppercase tracking-wider mb-3"
                  >
                    {title}
                  </h3>
                  {linkItems && Array.isArray(linkItems) && linkItems.length > 0 && (
                    <ul class="space-y-1.5" role="list">
                      {linkItems.map(({ text, href, ariaLabel }) => (
                        <li>
                          <a
                            class="text-slate-500 text-xs hover:text-primary transition-colors duration-200"
                            href={href}
                            aria-label={ariaLabel}
                          >
                            <Fragment set:html={text} />
                          </a>
                        </li>
                      ))}
                    </ul>
                  )}
                </nav>
              ))
            }
          </div>
        </div>

        {/* Newsletter - compact */}
        <div class="lg:col-span-3">
          <div class="p-4 rounded-xl bg-white/5 border border-white/10">
            <h3 class="text-white font-medium text-xs uppercase tracking-wider mb-2">Stay Updated</h3>
            <p class="text-slate-500 text-xs mb-3">Get insights delivered to your inbox.</p>
            <form action="https://api.web3forms.com/submit" method="POST" class="flex gap-2">
              <input type="hidden" name="access_key" value="ced19947-dbea-4cc7-8187-f3b698a668d2" />
              <input type="hidden" name="subject" value="New Newsletter Subscription" />
              <input type="hidden" name="from_name" value="Newsletter Signup" />
              <input type="hidden" name="redirect" value="https://criztec.com/?subscribed=true" />
              <input
                type="email"
                name="email"
                required
                placeholder="Email"
                class="flex-1 min-w-0 px-3 py-2 rounded-lg bg-white/5 border border-white/10 text-white placeholder-slate-600 text-xs focus:outline-none focus:border-primary/50 transition-colors"
              />
              <button
                type="submit"
                class="px-3 py-2 rounded-lg bg-gradient-to-r from-primary to-amber-500 text-white text-xs font-medium hover:shadow-lg hover:shadow-primary/20 transition-all duration-200"
              >
                Join
              </button>
            </form>
          </div>
        </div>
      </div>

      {/* Trust Badges - New Section */}
      {
        trustBadges?.length ? (
          <div class="border-t border-white/10 pt-8 mt-8">
            <div class="flex flex-wrap justify-center items-center gap-8 md:gap-12 opacity-75 grayscale hover:grayscale-0 transition-all duration-500">
              {trustBadges.map(({ icon, href, ariaLabel }) => (
                <a
                  href={href}
                  aria-label={ariaLabel}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="hover:scale-110 transition-transform duration-300"
                >
                  <Icon name={icon} class="h-8 md:h-10 w-auto" />
                </a>
              ))}
            </div>
          </div>
        ) : null
      }

      {/* Bottom bar - compact */}
      <div class="mt-8 pt-5 border-t border-white/10">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
          {/* Secondary Links */}
          <div class="flex flex-wrap items-center justify-center sm:justify-start gap-x-4 gap-y-1">
            {
              secondaryLinks.map(({ text, href }) => (
                <a class="text-slate-600 text-xs hover:text-primary transition-colors" href={href}>
                  <Fragment set:html={text} />
                </a>
              ))
            }
          </div>

          {/* Footer Note */}
          <div class="text-center sm:text-right">
            <div class="text-slate-600 text-xs">
              <Fragment set:html={footNote} />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>

{/* Back to Top Button */}
<button
  id="back-to-top"
  class="fixed bottom-6 right-6 w-12 h-12 rounded-xl bg-gradient-to-br from-primary to-amber-500 text-white flex items-center justify-center opacity-0 invisible translate-y-4 transition-all duration-300 z-50 shadow-lg shadow-primary/25 hover:shadow-xl hover:shadow-primary/30 hover:-translate-y-1 hover:scale-105 group"
  aria-label="Back to top"
>
  <Icon name="tabler:chevron-up" class="w-5 h-5 group-hover:-translate-y-0.5 transition-transform duration-300" />
</button>

<style>
  @keyframes gradient-x {
    0%,
    100% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
  }
  .animate-gradient-x {
    animation: gradient-x 3s ease infinite;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const backToTopButton = document.getElementById('back-to-top');

    if (backToTopButton) {
      // Show/hide back to top button
      const toggleBackToTop = () => {
        if (window.scrollY > 500) {
          backToTopButton.classList.remove('opacity-0', 'invisible', 'translate-y-4');
          backToTopButton.classList.add('opacity-100', 'visible', 'translate-y-0');
        } else {
          backToTopButton.classList.add('opacity-0', 'invisible', 'translate-y-4');
          backToTopButton.classList.remove('opacity-100', 'visible', 'translate-y-0');
        }
      };

      window.addEventListener('scroll', toggleBackToTop, { passive: true });

      // Smooth scroll to top
      backToTopButton.addEventListener('click', () => {
        window.scrollTo({
          top: 0,
          behavior: 'smooth',
        });
      });
    }
  });
</script>
